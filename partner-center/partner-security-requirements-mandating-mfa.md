---
title: Предписывания MFA для клиента-партнера | Центр партнеров
ms.topic: article
ms.date: 11/12/2019
ms.service: partner-dashboard
ms.subservice: partnercenter-csp
description: Узнайте, как предписывания MFA для ваших партнерских клиентов поможет защитить ваш доступ к ресурсам клиента. Включает примеры сценариев.
author: isaiahwilliams
ms.author: iswillia
keywords: Azure Active Directory, поставщик облачных решений, программа поставщика облачных решений, CSP, поставщик панели управления, CPV, многофакторная проверка подлинности, MFA, модель безопасного приложения, безопасность
ms.localizationpriority: medium
ms.openlocfilehash: dd54d10bb75fe732cddc34c48058b3ba95eac9ae
ms.sourcegitcommit: 07eb5eb6c1cfed1c84fad3626b8f989247341e70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2019
ms.locfileid: "75004993"
---
# <a name="mandating-multi-factor-authentication-mfa-for-your-partner-tenant"></a>Предписывания многофакторной идентификации (MFA) для клиента-партнера

**Относится к**

- Всем партнерам в программе для поставщиков облачных решений:
  - прямое выставление счетов;
  - непрямой поставщик;
  - Косвенный торговый посредник
- Всем консультантам.

**Соответствующие роли**
-   Глобальный администратор
-   администратор пользователей.
-   Агент администрирования
-   Администратор выставления счетов
-   Администратор партнера MPN

Эти партнеры должны пройти проверку MFA для следующих областей:

- [Панель мониторинга центра партнеров](#partner-center-dashboard) (нацеливание на H1 CY2020)
- [API центра партнеров](#partner-center-api) (нацеливание на H1 CY2020)
- [Делегированное администрирование партнера](#partner-delegated-administration) (начиная с 18 ноября 2019 г.)

Цель этой функции — помочь партнерам защитить доступ к ресурсам клиентов от взлома учетных данных.

## <a name="partner-center-dashboard"></a>Панель мониторинга центра партнеров
Некоторые страницы на панели мониторинга центра партнеров будут защищены с помощью MFA, включая:

* Все страницы на вкладке " **Клиенты** ".
* Все страницы на вкладке **поддержка > запросы клиентов** .

Если вы попытаетесь получить доступ к любой из этих страниц и вы не прошли проверку MFA ранее, вам потребуется это сделать.

Следующие типы пользователей имеют право на доступ к этим страницам, защищенным с помощью MFA, поэтому они зависят от этой функции, включая:

* Агенты администратора
* Агенты продаж
* Агенты службы поддержки

Чтобы продемонстрировать, как это работает, рассмотрим два следующих примера.

**Пример 1. партнер реализовал Azure AD MFA**
1.  Мария работает с CSP contoso. Компания Contoso реализовала MFA для всех пользователей в партнерской клиентской компании Contoso с помощью Azure AD MFA.
2.  На своей рабочей станции Мария запускает новый сеанс браузера и переходит на страницу обзора панели мониторинга центра партнеров (которая не защищена с помощью MFA). Центр партнеров перенаправляет Джейн в Azure AD для входа.
3.  В связи с настройкой Azure AD MFA с помощью Contoso компания Джейн необходима для выполнения проверки MFA. После успешного входа и проверки MFA Мария перенаправляется обратно на страницу обзора панели мониторинга центра партнеров.
4.  Мария пытается получить доступ к одной из страниц, защищенных с помощью MFA, в центре партнеров. Так как Мария уже выполнила проверку MFA во время входа ранее, Мария может получить доступ к странице, защищенной с помощью MFA, без необходимости повторно пройти проверку MFA.

**Пример 2. партнер реализовал третью MFA с помощью федерации удостоверений**
1. Trent) работает для CSP Wingtip. Компания Wingtip реализовала MFA для всех пользователей в клиенте Wingtip Partner, используя сторонние средства MFA, интегрированные с Azure AD через федерацию удостоверений.
2. На своей рабочей станции Trent) запускает новый сеанс браузера и переходит на страницу обзора панели мониторинга центра партнеров (которая не защищена с помощью MFA). Центр партнеров перенаправляет Джастин в Azure AD для входа.
3. Так как компания Wingtip настроила федерацию удостоверений, Azure AD перенаправляет Trent) в федеративный поставщик удостоверений для завершения входа и проверки MFA. После успешного входа и проверки MFA Trent) перенаправляется обратно в Azure AD, а затем на страницу обзора панели мониторинга центра партнеров.
4. Джастин пытается получить доступ к одной из страниц, защищенных с помощью MFA, в центре партнеров. Так как Trent) уже выполнил проверку MFA во время входа ранее, Trent) может получить доступ к защищенной странице MFA без необходимости повторного выполнения проверки MFA.

**Пример 3. партнер не реализовал MFA**
1. Джон работает для CSP Fabrikam. Компания Fabrikam не реализовала MFA для любого пользователя в партнерской клиентской компании Fabrikam.
2. На своей рабочей станции Джон запускает новый сеанс браузера и переходит на страницу обзора панели мониторинга центра партнеров (которая не защищена с помощью MFA). Центр партнеров перенаправляет пользователя Джон в Azure AD для входа.
3. Поскольку компания Fabrikam не реализовала MFA, Джон не требуется для выполнения проверки MFA. После успешного входа Джон перенаправляется обратно на страницу обзора панели мониторинга центра партнеров.
4. Джон пытается получить доступ к одной из страниц, защищенных с помощью MFA, в центре партнеров. Так как Джон не завершил проверку MFA, центр партнеров перенаправляет Джон в Azure AD для завершения проверки MFA. Поскольку в первый раз Джон требуется для завершения MFA, Джон также запрашивает регистрацию для MFA с помощью Microsoft Authenticator приложения. После успешной регистрации MFA и проверки MFA Джон теперь может получить доступ к странице, защищенной с помощью MFA.

## <a name="partner-center-api"></a>API центра партнеров

API-интерфейс центра партнеров поддерживает проверку подлинности только с помощью приложений и аутентификацию приложений и пользователей. При использовании проверки подлинности "приложение + пользователь" Центр партнеров потребует проверки MFA. В частности, когда партнерское приложение хочет отправить запрос API в центр партнеров, он должен включить маркер доступа в заголовок авторизации запроса. Когда центр партнеров получает запрос API с маркером доступа, полученным с помощью проверки подлинности приложения и пользователя, API центра партнеров проверит наличие значения *MFA* в утверждении *ссылки на метод проверки подлинности (AMR)* . С помощью декодера JWT можно проверить, содержит ли маркер доступа ожидаемое значение ссылки на метод проверки подлинности (AMR).

``` csharp
{
  "aud": "https://api.partnercenter.microsoft.com",
  "iss": "https://sts.windows.net/df845f1a-7b35-40a2-ba78-6481de91f8ae/",
  "iat": 1549088552,
  "nbf": 1549088552,
  "exp": 1549092452,
  "acr": "1",
  "amr": [
    "pwd",
    "mfa"
  ],
  "appid": "23ec45a3-5127-4185-9eff-c8887839e6ab",
  "appidacr": "0",
  "family_name": "Williams",
  "given_name": "Isaiah",
  "ipaddr": "127.0.0.1",
  "name": "Isaiah Williams",
  "oid": "4988e250-5aee-482a-9136-6d269cb755c0",
  "scp": "user_impersonation",
  "tenant_region_scope": "NA",
  "tid": "df845f1a-7b35-40a2-ba78-6481de91f8ae",
  "unique_name": "Isaiah.Williams@testtestpartner.onmicrosoft.com",
  "upn": "Isaiah.Williams@testtestpartner.onmicrosoft.com",
  "ver": "1.0"
}
```

Если указано значение, центр партнеров завершает проверку MFA и обрабатывает запрос API. Если значение отсутствует, API центра партнеров отклонит запрос со следующим ответом:

``` csharp
HTTP/1.1 401 Unauthorized - MFA required
Transfer-Encoding: chunked
Request-Context: appId=cid-v1:03ce8ca8-8373-4021-8f25-d5dd45c7b12f
WWW-Authenticate: Bearer error="invalid_token"
Date: Thu, 14 Feb 2019 21:54:58 GMT
```

## <a name="partner-delegated-administration"></a>Делегированное администрирование партнера

### <a name="using-service-portals"></a>Использование порталов служб

Учетные записи партнеров, в том числе агенты администратора и агенты службы поддержки, могут использовать делегированные права администратора для управления ресурсами клиентов с помощью порталов Microsoft Online Services, интерфейса командной строки (CLI) и интерфейсов API (с использованием проверки подлинности приложений и пользователей).

При доступе к порталам Microsoft Online Services с помощью партнера с делегированными полномочиями администратора для управления ресурсами клиентов многие из этих порталов требуют, чтобы учетная запись партнера была в интерактивном режиме, с клиентом Azure Active Directory клиентским набором. контекст проверки подлинности — учетная запись партнера необходима для входа в клиент клиента.

Когда Azure Active Directory получает такие запросы проверки подлинности, ему потребуется учетная запись партнера для выполнения проверки MFA. Существует два возможных пользовательского интерфейса, в зависимости от того, является ли учетная запись партнера управляемым или федеративным удостоверением:

- Если учетная запись партнера является **управляемой** , Azure Active Directory предложит пользователю выполнить проверку mfa. Если учетная запись партнера не зарегистрирована для MFA с Azure Active Directory ранее, пользователю будет предложено сначала [выполнить регистрацию MFA](#mfa-registration-experience) .

- Если учетная запись партнера является **федеративным** удостоверением, взаимодействие зависит от того, как администратор партнера настроил федерацию в Azure Active Directory. При настройке Федерации в Azure Active Directory администратор партнера может указать Azure Active Directory, поддерживает ли федеративный поставщик удостоверений MFA. В этом случае Azure Active Directory перенаправит пользователя на федеративный поставщик удостоверений для завершения проверки MFA. В противном случае Azure Active Directory будет напрямую предлагать пользователю выполнить проверку MFA. Если учетная запись партнера не зарегистрирована для MFA с Azure Active Directory ранее, пользователю будет предложено сначала [выполнить регистрацию MFA](#mfa-registration-experience) .

Общий интерфейс очень похож на сценарий, в котором клиент конечного клиента реализовал MFA для своих администраторов. Например, клиент клиента включил [политику базовых показателей Azure AD — MFA для администраторов](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-baseline-protect-administrators), которая требует, чтобы все учетные записи с правами администратора вошли в клиент клиента с проверкой MFA, включая агенты администратора и агенты службы поддержки. В целях тестирования партнеры могут включить в клиенте клиента [политику MFA для администраторов](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-baseline-protect-administrators) , а затем попытаться использовать права делегированного администрирования партнера для доступа к клиенту клиента.

> [!NOTE]
> Не все порталы служб Microsoft Online Services требуют учетных записей партнеров для входа в клиентский клиент при доступе к ресурсам клиента с помощью делегированных прав администратора партнера. Вместо этого им требуются только партнерские учетные записи для входа в клиент-партнер. Примером является центр администрирования Exchange. Со временем эти порталы должны требовать от партнерских учетных записей входить в клиент клиента при использовании делегированных прав администратора партнера.

### <a name="using-service-apis"></a>Использование API-интерфейсов службы
Некоторые API-интерфейсы Microsoft Online Services (например, Azure Resource Manager, Azure AD Graph, Microsoft Graph и т. д.) поддерживают партнеров, использующие делегированные права администратора для программного управления ресурсами клиентов. Чтобы использовать полномочные привилегии администратора с этими API, партнерское приложение должно включить маркер доступа в заголовок авторизации запроса API, где маркер доступа получается с помощью учетной записи партнера для аутентификации в Azure AD, с Клиент Azure AD задается в качестве контекста проверки подлинности. Партнерское приложение должно входить в клиентскую учетную запись с правами партнера.

Когда Azure AD получает такие запросы на аутентификацию, Azure AD потребуется учетная запись партнера для выполнения проверки MFA. Если учетная запись партнера не зарегистрирована для MFA ранее, учетной записи пользователя будет предложено сначала выполнить регистрацию MFA.

Эта функция затрагивает все партнерские приложения, интегрированные с этими API-интерфейсами с использованием делегированных прав администратора партнера. Чтобы обеспечить партнерским приложениям возможность продолжать работу с этими API-интерфейсами без перерывов:

- Чтобы получить маркер доступа, партнер должен избегать использования неинтерактивного метода проверки подлинности пользователя в Azure AD. При использовании неинтерактивного метода проверки подлинности пользователя, такого как [поток паролей](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/wiki/Acquiring-tokens-with-username-and-password), Azure AD не сможет предлагать пользователю выполнить проверку mfa. Партнер должен переключиться на использование метода проверки подлинности интерактивного пользователя, такого как [OpenID Connect Connect Flow](https://docs.microsoft.com/azure/active-directory/develop/v1-protocols-openid-connect-code) .
- Во время проверки подлинности интерактивного пользователя партнер должен использовать учетную запись пользователя партнера, которая уже включена для MFA. Кроме того, при появлении запроса Azure AD партнер может выполнить регистрацию MFA и проверку MFA во время входа.
- Это очень похоже на ситуацию, когда клиент конечного клиента реализовал MFA для своих администраторов. Например, клиент клиента включил [политику базовых показателей Azure AD — MFA для администраторов](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-baseline-protect-administrators), которая требует, чтобы все учетные записи пользователей с правами администратора вошли в клиент клиента с проверкой MFA, включая агенты администратора и агенты службы поддержки. В целях тестирования партнеры могут включить [политику MFA для администраторов](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-baseline-protect-administrators) в клиенте клиента, а затем использовать делегированные привилегии администратора для программного доступа к клиенту клиента.

### <a name="mfa-registration-experience"></a>Возможности регистрации MFA
Если при проверке MFA учетная запись партнера еще не зарегистрирована для MFA, Azure AD будет предлагать пользователю сначала выполнить регистрацию MFA:

![Регистрация MFA, шаг 1](images/MfaRegistration1.png)

После нажатия кнопки **Далее**пользователю будет предложено выбрать из списка методов проверки (включая телефон, SMS и приложение проверки подлинности).

![Регистрация MFA, шаг 2](images/MfaRegistration2.png)

После успешной регистрации пользователь должен выполнить проверку MFA на основе проверки, выбранной пользователем.



## <a name="request-for-technical-exception"></a>Запрос на техническое исключение

Партнеры могут обратиться к техническим исключениям, чтобы подавить проверку MFA, если они сталкиваются с техническими проблемами со службами Microsoft Online Services, и нет подходящего решения или обходного пути. Перед этим проверьте следующие разделы:

 - [Список распространенных проблем, о которых сообщили партнеры](#list-of-common-issues-reported-by-partners)
 - [Как отправить запрос на техническое исключение](#how-to-submit-a-request-for-technical-exception)
 
### <a name="list-of-common-issues-reported-by-partners"></a>Список распространенных проблем, о которых сообщили партнеры
Перед применением для технического исключения ознакомьтесь со списком распространенных проблем, о которых сообщили другие участники, чтобы понять, являются ли они допустимыми причинами для технического исключения.

#### <a name="issue-1-partner-needs-more-time-to-implement-mfa-for-their-partner-agents"></a>Причина 1. партнеру требуется больше времени для реализации MFA для своих агентов партнеров.
Партнер не начал работу или по-прежнему находится в процессе реализации MFA для своих партнерских агентов, которым требуется доступ к порталам Microsoft Online Services с помощью делегированных административных привилегий для управления ресурсами клиентов. Партнеру требуется больше времени для завершения реализации MFA. Является ли это действительной причиной для технического исключения?

**Ответ.** Нет. Партнер должен принять планы по реализации MFA для пользователей, чтобы избежать перерывов в работе.

> [!NOTE]
> Несмотря на то, что партнер не реализовал MFA для своих агентов-партнеров, агенты партнеров по-прежнему могут получить доступ к порталам Microsoft Online Services, используя делегированные привилегии администратора, если они могут завершить регистрацию MFA и проверку MFA. При появлении запроса во время входа в клиент клиента. Завершение регистрации MFA не включает автоматическое включение MFA для пользователя.

##### <a name="issue-2-partner-has-not-implemented-mfa-for-user-accounts-not-using-delegated-admin-privileges"></a>Причина 2. партнер не реализовал MFA для учетных записей пользователей, не использующих делегированные права администратора
У партнера есть несколько пользователей в своих партнерских клиентах, которым не требуется доступ к порталам Microsoft Online Services для управления ресурсами клиентов с помощью делегированных прав администратора партнера. Этот партнер в процессе реализации MFA для этих пользователей требует больше времени на выполнение. Является ли это действительной причиной для технического исключения?

**Ответ.** Нет. Так как эти учетные записи пользователей не используют делегированные административные привилегии для управления ресурсами клиентов, им не потребуется входить в клиент. В Azure AD не будут затронуты проверки MFA во время входа в клиент клиента.

##### <a name="issue-3-partner-has-not-implemented-mfa-for-user-service-accounts"></a>Причина 3. партнер не реализовал MFA для учетных записей служб пользователей
У партнера есть некоторые учетные записи пользователей в партнерских клиентах, которые используются устройствами как учетные записи служб. Обычно это учетные записи с низким уровнем привилегий, которым не требуется доступ к центрам партнеров и порталам Microsoft Online Services для управления ресурсами клиентов с помощью делегированных прав администратора партнера. Является ли это действительной причиной для технического исключения?

**Ответ.** Нет. Так как эти учетные записи пользователей не используют делегированные административные привилегии для управления ресурсами клиентов, им не потребуется входить в клиент. В Azure AD не будут затронуты проверки MFA во время входа в клиент клиента.

#### <a name="issue-4-partner-cannot-implement-mfa-using-ms-authenticator-app"></a>Причина 4. партнер не может реализовать MFA с помощью приложения MS Authenticator.
У партнера есть политика "Очистить рабочий стол", которая не позволяет сотрудникам переводить свои персональные мобильные устройства в рабочую область. Без доступа к персональным мобильным устройствам сотрудники не могут установить приложение MS Authenticator, которое является единственной проверкой MFA, поддерживаемой базовыми политиками Azure AD. Является ли это действительной причиной для технического исключения?

**Ответ**. нет, это не является допустимой причиной для технического исключения. Партнер должен принять во внимание следующие альтернативы, чтобы их сотрудники по-прежнему могли выполнять проверку MFA при доступе к центру партнеров:
- Кроме приложения MS Authenticator, базовые политики Azure AD также могут использоваться с совместимым приложением для проверки подлинности сторонних разработчиков, которое может поддерживать компьютеры Windows под управлением Microsoft Windows.
- Партнер также может зарегистрироваться для Azure AD Premium или сторонних решений MFA (совместимых с Azure AD), которые могут предоставить дополнительные методы проверки.

#### <a name="issue-5-partner-cannot-implement-mfa-due-to-the-use-of-legacy-authentication-protocols"></a>Причина 5. партнер не может реализовать MFA из-за использования устаревших протоколов проверки подлинности
У партнера есть несколько агентов партнеров, которые по-прежнему используют устаревшие протоколы проверки подлинности, не совместимые с MFA. Например, пользователи по-прежнему используют Outlook 2010, основанный на устаревших протоколах проверки подлинности. Включение MFA для этих агентов-партнеров приведет к нарушению использования устаревших протоколов проверки подлинности.

**Ответ**. нет, это не является допустимой причиной для технического исключения. Партнерам настоятельно рекомендуется отказаться от использования устаревших протоколов проверки подлинности в связи с возможными последствиями безопасности, так как эти протоколы не могут быть защищены с помощью проверки MFA и гораздо более уязвимы для компрометации учетных данных. Если нет возможности использовать устаревшие протоколы проверки подлинности, партнеры должны рассмотреть возможность регистрации в Azure AD Premium, которая поддерживает использование паролей приложений. Пароли приложений — это одноразовые, созданные системой пароли, которые обычно надежнее, чем созданные пользователем пароли. Используя пароли приложений, партнеры могут реализовать MFA для своих пользователей, в то же время пребравшись в пароли приложений только для устаревших протоколов проверки подлинности.

> [!NOTE]
> Несмотря на то, что партнер не реализовал MFA для своих агентов-партнеров, агенты партнеров по-прежнему могут получить доступ к порталам Microsoft Online Services, используя делегированные привилегии администратора, если они могут завершить регистрацию MFA и проверку MFA. При появлении запроса во время входа в клиент клиента. Завершение регистрации MFA не включает автоматическое включение MFA для пользователя.

#### <a name="issue-6-partner-is-using-exchange-online-powershell-which-does-not-support-mfa"></a>Причина 6. партнер использует Exchange Online PowerShell, который не поддерживает MFA.
Партнер использует Exchange Online PowerShell с делегированными привилегиями администратора партнера для управления службой Exchange Online от имени своих клиентов. Exchange Online PowerShell не поддерживает MFA. Если партнер применяет MFA для своих пользователей, эти пользователи больше не смогут получить доступ к Exchange Online PowerShell. Является ли это действительной причиной для технического исключения?

**Ответ**. Да, это может считаться действительной причиной для технического исключения. Существующий [модуль Exchange Online PowerShell, который поддерживает делегированное администрирование партнера](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell?view=exchange-ps) , не требует от пользователя-партнера войти в клиент клиента и, следовательно, не затрагивается Azure AD, требующей проверки mfa. Однако он не совместим с MFA. Группа Microsoft Exchange Online разрабатывает новый модуль PowerShell, поддерживающий делегированные административные привилегии и MFA. Пока новый модуль PowerShell не будет доступен, партнеры не смогут реализовать MFA для пользователей, которым необходимо использовать существующий модуль PowerShell. Если эти пользователи сталкиваются с проблемами при обращении к другим службам Microsoft Online Services из-за того, что Azure AD требует проверки MFA во время входа между клиентами, партнеры могут запросить техническое исключение, чтобы отключить проверку MFA.

> [!NOTE]
> Несмотря на то, что партнер не может реализовать MFA для пользователей, которым требуется доступ к модулю Exchange Online PowerShell, эти пользователи по-прежнему могут получить доступ к службам Microsoft Online Services для управления ресурсами клиентов с помощью предоставленных прав делегированных административных привилегий. они могут выполнить регистрацию MFA и проверку MFA при появлении запроса во время входа в клиент клиента. Завершение регистрации MFA не включает автоматическое включение MFA для пользователя и, следовательно, не влияет на доступ к модулю Exchange Online PowerShell.

#### <a name="issue-7-partner-has-implemented-3rd-party-mfa-which-isnt-recognized-by-azure-ad"></a>Выпуск 7. в партнере реализованы сторонние MFA, которые не распознаются Azure AD.
Партнер реализовал MFA для своих пользователей, используя стороннее решение MFA. Однако партнер не может правильно настроить стороннее решение MFA для ретрансляции в Azure AD, что проверка MFA была выполнена во время проверки подлинности пользователя. Является ли это действительной причиной для технического исключения?

**Ответ**. Да, это может считаться действительной причиной для технического исключения. Перед отправкой запроса на техническое исключение необходимо подтвердить у стороннего поставщика решений MFA, что решение MFA не может быть настроено для передачи утверждения *аусентикатионмесодсреференцес* (со значением *Мултиплеаусн*) в Azure AD, чтобы указать, что проверка MFA была завершена во время проверки подлинности пользователя. При отправке запроса на техническое исключение укажите сведения об используемом решении MFA стороннего производителя и укажите метод интеграции (например, через федерацию удостоверений или пользовательский элемент управления Azure AD).

### <a name="how-to-submit-a-request-for-technical-exception"></a>Как отправить запрос на техническое исключение

Чтобы отправить запрос на техническое исключение:

1. Войдите в центр партнеров в качестве глобального администратора или агента администратора.
2. Создайте запрос на обслуживание партнера, перейдя в **службу поддержки** > **партнерские запросы** и щелкнув **создать запрос**.
4. В разделе **MFA и защищенной модели приложений** ыделить **Отправить запрос на техническое исключение** в качестве типа проблемы.
6. Укажите сведения, запрошенные для отправки запроса на обслуживание для технического исключения, и нажмите кнопку " **Отправить**".

Корпорация Майкрософт может пройти до 3 рабочих дней, чтобы предоставить ответ на запрос технического исключения.
