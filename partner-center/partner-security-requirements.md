---
title: Требованиях к безопасности для партнеров | Центр партнеров
ms.topic: article
ms.date: 08/30/2019
description: Сведения о требованиях к безопасности для консультантов и партнеров, участвующих в программе для поставщиков облачных решений.
author: isaiahwilliams
ms.author: iswillia
keywords: Azure Active Directory, поставщик облачных решений, программа поставщика облачных решений, CSP, поставщик панели управления, CPV, многофакторная проверка подлинности, MFA, модель безопасного приложения, безопасность
ms.localizationpriority: medium
ms.openlocfilehash: c95ec38f928ca4032ffecebaf25f23e87d10c079
ms.sourcegitcommit: de3cdc792b6b4bbc64d1288d371623d79d535205
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/03/2019
ms.locfileid: "70215650"
---
# <a name="partner-security-requirements"></a>Требования к безопасности для партнеров

**Относится к**

- Всем партнерам в программе для поставщиков облачных решений:
  - прямое выставление счетов;
  - непрямой поставщик;
  - Косвенный торговый посредник
- Всем поставщикам панели управления.
- Всем консультантам.

Более высокий уровень конфиденциальности и безопасности является одним из наших главных приоритетов. Мы знаем, что лучшая защита — это предотвращение, и что мы не сильнее самого слабого звена. Именно поэтому каждый элемент в нашей экосистеме должен действовать должным образом, обеспечивая надлежащую защиту. В целях обеспечения защиты для партнеров и клиентов мы вводим набор обязательных требований к безопасности для консультантов, поставщиков панели управления и партнеров, участвующих в программе для поставщиков облачных решений.

Начиная с 1 августа 2019 года все партнеры обязаны применять в своем клиенте многофакторную проверку подлинности для всех пользователей, включая учетные записи служб.

> [!NOTE]
> Мы настоятельно рекомендуем всем партнерам, осуществляющим операции через национальное облако (21Vianet, US Governmen и Germany), немедленно принять эти новые требования к безопасности. Однако эти партнеры не обязаны соответствовать новым требованиям к безопасности, вступившим в силу 1 августа 2019 года. Корпорация Майкрософт предоставит дополнительные сведения о применении этих требований к безопасности для национальных облаков в будущем.

Условия, связанные с требованиями к безопасности для партнеров, добавлены в [руководство по работе с программой для поставщиков облачных решений](https://go.microsoft.com/fwlink/p/?LinkId=617100). Начиная с 1 августа 2019 года все партнеры, участвующие в программе для поставщиков облачных решений, должны соблюдать эти условия. Что касается консультантов, то для них будут действовать те же контрактные требования.

Партнеры, которые не выполнят обязательные требования к безопасности, не смогут осуществлять транзакции в программе для поставщиков облачных решений или управлять клиентами, используя делегированные права администратора, после соблюдения этих требований. В настоящее время мы устанавливаем дату технического применения этих требований, а после уведомим партнеров о ней, предоставив подробные сведения.

## <a name="what-actions-do-i-need-to-take"></a>Какие действия необходимо предпринять?

Учитывая высокий уровень привилегии партнеров, мы должны обеспечить для каждого пользователя появление запроса MFA при выполнении каждой отдельной проверки подлинности. Это можно сделать одним из следующих способов:

- Реализация Azure AD Premium и обеспечение применения MFA для каждого пользователя.
- Реализация [базовых политик защиты](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-baseline-protection).
- Реализация стороннего решения и обеспечение применения MFA для каждого пользователя.

> [!IMPORTANT]
> После технического применения этих требований каждый раз при выполнении проверки подлинности должен отображаться запрос MFA. Вы не сможете с помощью функций условного доступа избежать выполнения проверки подлинности с использованием MFA при доступе к коммерческим облачным службам Майкрософт.

### <a name="considerations"></a>Рекомендации

Так как эти требования применяются ко всем пользователям в клиенте партнера, включая учетные записи служб, для обеспечения беспрепятственного развертывания необходимо учитывать несколько факторов. К ним относится идентификация пользователей в Azure AD, которые не могут выполнять MFA, а также приложений и устройств вашей организации, которые не поддерживают современную проверку подлинности.

Перед выполнением каких-либо действий советуем определить следующее:

#### <a name="do-you-have-an-application-or-device-that-does-not-support-the-use-of-mfa-when-authenticating"></a>Есть ли у вас приложение или устройство, которое не поддерживает использование MFA при выполнении проверки подлинности?

При применении устаревшего механизма проверки подлинности MFA использование протоколов, таких как IMAP, POP3, SMTP и т. д., будет заблокировано, так как они не поддерживают MFA. Чтобы устранить это ограничение, воспользуйтесь функцией, называемой [пароли приложения](https://docs.microsoft.com/azure/active-directory/authentication/howto-mfa-mfasettings#app-passwords), чтобы проверить, можно ли еще выполнять проверку подлинности в приложении или на устройстве. Вам следует ознакомиться с советами по использованию паролей приложений, приведенных [в этом разделе](https://docs.microsoft.com/azure/active-directory/authentication/howto-mfa-mfasettings#considerations-about-app-passwords), чтобы определить, можно ли использовать их в вашей среде.

#### <a name="do-you-have-users-using-office-365-provided-by-licenses-associated-with-your-partner-tenant"></a>Есть ли у вас пользователи Office 365 с лицензиями, связанными с вашим клиентом партнера?

Перед реализацией какого-либо решения советуем определить, почему пользователи применяют версию Microsoft Office в вашем клиенте партнера. Ознакомьтесь с [инструкциями по выполнению многофакторной проверки подлинности для развертываний Office 365](https://docs.microsoft.com/office365/admin/security-and-compliance/multi-factor-authentication-plan#enable-mfa), прежде чем предпринимать какие-либо действия. Есть вероятность, что у ваших пользователей будут возникать проблемы с подключением таких приложений, как Outlook. Перед применением MFA убедитесь, что вы используете Outlook 2013 SP1 или более поздней версии и в вашей организации включена современная проверка подлинности. Дополнительные сведения см. в статье [Включение современной проверки подлинности в Exchange Online](https://docs.microsoft.com/exchange/clients-and-mobile-in-exchange-online/enable-or-disable-modern-authentication-in-exchange-online).

Чтобы включить современную проверку подлинности для любых устройств под управлением Windows, на которых установлен пакет Microsoft Office 2013, необходимо будет создать два раздела реестра. Дополнительные сведения см. в статье [Enable Modern Authentication for Office 2013 on Windows devices](https://docs.microsoft.com/office365/admin/security-and-compliance/enable-modern-authentication) (Включение современной проверки подлинности для Office 2013 на устройствах с Windows).

> [!IMPORTANT]
> Если вы включили Azure AD MFA для своих пользователей, а у них есть устройства с Office 2013, которые не поддерживают современную проверку подлинности, они должны будут использовать пароли приложений на этих устройствах. Дополнительные сведения о паролях приложений и их использовании см. в следующей статье: [Manage your two-factor verification method settings](https://go.microsoft.com/fwlink/p/?LinkId=528178) (Управление параметрами метода многофакторной проверки подлинности).

#### <a name="is-there-a-policy-preventing-any-of-your-users-from-using-their-mobile-devices-while-working"></a>Существует ли политика, запрещающая вашим пользователям использовать мобильные устройства во время работы?

Важно определить любую корпоративную политику, запрещающую сотрудникам использовать мобильные устройства во время работы, так как она влияет на тип реализуемого решения MFA. Существуют решения MFA, предоставленные путем реализации [базовых политик защиты](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-baseline-protection), которые позволяют использовать только приложение Authenticator для проверки. Если в вашей организации есть политика, запрещающая использование мобильных устройств, рассмотрите один из следующих вариантов:

- Развертывание приложения, поддерживающего временные одноразовые пароли (TOTP), которое может работать в защищенной системе.
- Реализация стороннего решения, применяющего MFA для каждого пользователя в клиенте партнера и обеспечивающего самый подходящий вариант проверки.
- Приобретение лицензий [Azure AD Premium](https://azure.microsoft.com/pricing/details/active-directory/) для затронутых пользователей.

Поддержка использования ключей безопасности FIDO представлена в плане развития для базовых политик защиты. После добавления поддержки вы сможете использовать ключи безопасности FIDO для второго фактора проверки подлинности. До тех пор вы не можете использовать приложение Authenticator.

#### <a name="what-automation-or-integration-do-you-have-that-leverages-user-credentials-for-authentication"></a>Какая автоматизация или интеграция использует учетные данные пользователя для проверки подлинности?

Так как требование состоит в принудительном применении MFA для каждого пользователя, включая учетные записи служб, в каталоге партнера будет затронута любая автоматизация или интеграция, которая использует учетные данные пользователя для проверки подлинности. Поэтому важно определить, какие учетные записи используются в данных ситуациях. Ниже приведен список примеров приложений или служб, на которые следует обратить внимание.

- Панель управления используется для подготовки ресурсов от имени клиентов.
- Интеграция с любой платформой, которая используется для выставления счетов (так как речь идет о программе CSP) и поддержки ваших клиентов.
- Сценарии PowerShell, использующие модули Az, AzureRM, Azure AD, MS Online и т. д.

Приведенный выше список не является исчерпывающим. Поэтому важно выполнить полную оценку любого приложения или службы в вашей среде, которая использует учетные данные пользователя для проверки подлинности. Для применения требования для MFA вы должны по возможности выполнить инструкции, приведенные в статье [Enabling the Secure Application Model framework](https://docs.microsoft.com/partner-center/develop/enable-secure-app-model) (Включение платформы модели безопасных приложений). Ниже приведены дополнительные ресурсы, содержащие сведения о реализации платформы модели безопасных приложений.

- [Partner Center .NET Samples](https://github.com/microsoft/partner-center-dotnet-samples) (Центр партнеров: примеры для .NET). Этот репозиторий GitHub содержит примеры, разработанные с использованием .NET, которые демонстрируют способ реализации платформы модели безопасных приложений.
- [Partner Center Java Samples](https://github.com/microsoft/partner-center-java-samples) (Центр партнеров: примеры для Java). Этот репозиторий GitHub содержит примеры, разработанные с использованием Java, которые демонстрируют способ реализации платформы модели безопасных приложений.
- [Secure Application Model](https://docs.microsoft.com/powershell/partnercenter/secure-app-model) (Модель безопасных приложений). Эта статья содержит подробные сведения о реализации платформы модели безопасных приложений с помощью PowerShell.
- [Partner Center Security Guidance Group](https://www.microsoftpartnercommunity.com/t5/Partner-Center-Security-Guidance/ct-p/partner-center-security-guidance) (Консультативная группа по обеспечению безопасности в Центре партнеров). Это онлайн-сообщество, где вы можете узнать о предстоящих событиях и задать любые вопросы, которые могут у вас возникнуть.

### <a name="enforcing-mfa-for-all-users"></a>Принудительное применение MFA для всех пользователей

В этом разделе рассматривается использование [базовых политик защиты](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-baseline-protection) для принудительного применения MFA для каждого пользователя в клиенте партнера, включая учетные записи служб. Если вы планируете использовать Azure AD Premium, выполните действия, описанные [в этой статье](https://docs.microsoft.com/azure/active-directory/authentication/howto-mfa-getstarted).

> [!NOTE]
> Стороннее решение, совместимое с Azure AD, можно использовать для принудительного применения MFA для всех пользователей, включая учетные записи служб. Дополнительные сведения о реализации решения см. в документации от поставщика.

Базовые политики защиты — это набор предопределенных политик, с помощью которых можно защитить организацию от многих распространенных атак. К таким распространенным атакам могут относиться распыление паролей, повторное воспроизведение и фишинг. Базовые политики защиты доступны во всех выпусках Azure Active Directory. Корпорация Майкрософт сделала эти базовые политики защиты общедоступными, чтобы клиенты и партнеры могли применять самые лучшие методы обеспечения безопасности.

Две базовые политики защиты, которые мы рекомендуем включить, описаны в приведенной ниже таблице.

|**Политика**| |
|-----|-----|
|**Требовать MFA для администраторов**|Включение политики "Требовать MFA для администраторов" требует от администраторов регистрацию для MFA, выполненную с помощью приложения Authenticator. После завершения регистрации MFA каждый раз при входе в систему администраторы должны будут выполнять проверку подлинности MFA.|
|**Защита конечных пользователей**|Защита конечных пользователей — это базовая политика защиты MFA на основе рисков, которая обеспечивает защиту всех пользователей в каталоге. Включение этой политики требует, чтобы все пользователи выполнили регистрацию Azure MFA с помощью приложения Authenticator. Пользователи могут игнорировать запрос на регистрацию MFA в течение 14 дней, после чего им будет запрещено входить в систему, пока они не зарегистрируются для MFA. После регистрации для MFA пользователям будет предложено выполнять MFA только во время попыток рискованного входа. Скомпрометированные учетные записи пользователей будут заблокированы до тех пор,пока их пароль не будет сброшен, а события риска не будут отклонены.|

Если эти политики включены, каждый пользователь сможет использовать Azure MFA с помощью приложения Authenticator для проверки без дополнительных затрат.

#### <a name="configure-self-service-password-reset"></a>Настройка самостоятельного сброса пароля

Самостоятельный сброс пароля (SSPR) — это функция Azure Active Directory, которая позволяет пользователям сбрасывать свои пароли без обращения в службу поддержки. Пользователи должны зарегистрироваться для самостоятельного сброса пароля перед использованием службы. Во время регистрации пользователь выбирает один или несколько методов проверки подлинности, разрешенных в его организации.

Если включена базовая политика [Защита конечных пользователей](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-baseline-protect-end-users), любые скомпрометированные учетные записи пользователей будут заблокированы до тех пор, пока их пароль не будет сброшен, а события риска не будут отклонены. Учитывая это, рекомендуем, чтобы каждый пользователь, являющийся глобальным администратором, выполнил приведенные ниже действия, чтобы зарегистрироваться для получения SSPR и предотвратить блокировку.

1. Перейдите на [страницу установки SSPR](https://aka.ms/ssprsetup).
2. Введите имя пользователя и пароль.
3. Настройте хотя бы один из вариантов проверок, которые будут использоваться для идентификации при сбросе пароля.  

Если учетная запись была взломана, администратор должен будет восстановить доступ для затронутого пользователя. Дополнительные сведения о разблокировке пользователя см. [в этом разделе](#recovering-compromised-accounts).

#### <a name="require-mfa-for-admins"></a>Требовать MFA для администраторов

Базовая политика *Требовать MFA для администраторов* требует выполнения MFA для указанных ниже ролей каталогов, которые считаются самыми привилегированными ролями Azure Active Directory:

- Глобальный администратор
- Администратор SharePoint.
- Администратор Exchange.
- Администратор условного доступа.
- Администратор безопасности.
- Администратор службы поддержки / администратор паролей.
- Администратор выставления счетов
- Администратор пользователей.

При включении политики "Требовать MFA для администраторов" от указанных выше девяти администраторов потребуется регистрация для MFA, выполненная с помощью приложения Authenticator. После завершения регистрации MFA каждый раз при входе в систему администраторы должны будут выполнять проверку подлинности MFA.

Если в вашей организации эти учетные записи используются в сценариях или коде, рассмотрите возможность замены их  [управляемыми удостоверениями](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview).

Чтобы включить эту политику и обеспечить защиту администраторов, сделайте следующее:

1. Войдите на  **портал Azure**  в качестве глобального администратора, администратора безопасности или администратора условного доступа.
2. Выберите **Azure Active Directory** > **Условный доступ**.
3. В списке политик выберите **Baseline policy: Require MFA for admins** (Базовая политика: требовать MFA для администраторов).
4. Для параметра **Включить политику** выберите значение **Использовать политику немедленно**.
5. Щелкните  **Сохранить**.

> [!WARNING]
> Перед включением этой политики убедитесь, что ваши пользователи не используют устаревшие протоколы проверки подлинности. Вследствие реализации этой политики устаревший механизм проверки подлинности будет заблокирован.

> [!IMPORTANT]
> Существует известная проблема, которая влияет на вашу возможность подключаться к Exchange Online PowerShell с помощью делегированных прав администратора. При использовании модуля PowerShell перед включением этой политики ознакомьтесь с разделом об известной проблеме [Exchange Online PowerShell](#exchange-online-powershell).

#### <a name="end-user-protection"></a>Защита конечных пользователей

Базовая политика "Защита конечных пользователей" обеспечивает защиту всех пользователей в каталоге. Включение этой политики требует, чтобы все пользователи выполнили регистрацию Azure MFA в течение 14 дней. После регистрации пользователям будет предложено выполнять MFA только во время попыток рискованного входа. Скомпрометированные учетные записи пользователей будут заблокированы до тех пор, пока пользователь не сбросит пароль и не отклонит события риска.

Политика **Baseline policy: End user protection** (Базовая политика: защита конечных пользователей) предварительно настроена. Она будет отображаться при переходе в колонку условного доступа на портале Azure.

Чтобы включить эту политику и обеспечить защиту пользователей, сделайте следующее:

1. Войдите на  **портал Azure**  в качестве глобального администратора, администратора безопасности или администратора условного доступа.
2. Выберите **Azure Active Directory** > **Условный доступ**.
3. В списке политик выберите **Baseline policy: End user protection (preview)** (Базовая политика: защита конечных пользователей (предварительная версия)).
4. Для параметра **Включить политику** выберите значение **Использовать политику немедленно**.
5. Щелкните  **Сохранить**.

> [!WARNING]
> Перед включением этой политики убедитесь, что ваши пользователи не используют устаревшие протоколы проверки подлинности. Вследствие реализации этой политики устаревший механизм проверки подлинности будет заблокирован.

> [!IMPORTANT]
> Существуют известные проблемы, влияющие на вашу возможность подключаться к Exchange Online PowerShell с помощью делегированных прав администратора. При использовании модуля PowerShell перед включением этой политики ознакомьтесь с разделом об известной проблеме [Exchange Online PowerShell](#exchange-online-powershell).

## <a name="assessing-your-environment"></a>Оценка среды

В соответствии с одним из текущих требований безопасности для партнеров, необходимо принудительно применить MFA для каждого пользователя в клиенте партнера. Так как это требование можно выполнить разными методами, может оказаться трудным определить, требуются ли какие-либо дополнительные действия. Вы можете воспользоваться такими инструментами, как журналы аудита Azure Active Directory и [Оценка безопасности (Майкрософт)](https://docs.microsoft.com/office365/securitycompliance/microsoft-secure-score), чтобы определить, требуются ли какие-либо дополнительные действия для защиты вашего клиента с помощью MFA. Корпорация Майкрософт работает над функциональностью Центра партнеров, чтобы обеспечить быструю проверку на соответствие требованиям MFA и модели безопасных приложений.

Оценка безопасности (Майкрософт) обеспечивает надежную визуализацию, интеграцию с другими продуктами Майкрософт, сравнение собственных оценок с оценками других компаний, фильтрацию по категориям и т. д. С помощью этого инструмента вы можете выполнять действия по улучшению безопасности в своей организации и отслеживать историю своих оценок. Оценка также может отражать реализацию рекомендуемых действий по повышению безопасности сторонними решениями.

![Оценка безопасности (Майкрософт)](images/security/secure-score.png)

> [!NOTE]
> Действия, выполняемые для улучшения Оценки безопасности (Майкрософт), вступят в силу в течение 24 часов.

Оценка безопасности (Майкрософт) предоставит только числовое представление вашего состояния безопасности. Чтобы точно определить, кто или что выполняет проверку подлинности, избежав появления запроса на выполнение MFA, рекомендуем запросить журналы аудита Azure Active Directory. Это можно сделать с помощью модуля [Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview) и приведенного ниже сценария. Он создаст отчет, который предоставит сведения о выполненных за прошедший день попытках проверки подлинности, для которых не было запроса на выполнение MFA.

```powershell
Login-AzAccount
$context = Get-AzContext

function Get-SignInEvents
{
    param([string]$userId)

    $content = '{"startDateTime":"' + (Get-Date).AddDays(-1).ToUniversalTime().ToString("yyyy-MM-ddT05:00:00.000Z") + '","endDateTime":"' + (Get-Date).ToUniversalTime().ToString("yyyy-MM-ddTHH:mm:ss.fffZ")  + '","userId":"' + $userId +'","riskState":[],"totalRisk":[],"realtimeRisk":[],"tokenIssuerType":[],"isAdfsEnabled":false}'

    $token = [Microsoft.Azure.Commands.Common.Authentication.AzureSession]::Instance.AuthenticationFactory.Authenticate($context.Account, $context.Environment, $context.Tenant.Id, $null, "Never", $null, "74658136-14ec-4630-ad9b-26e160ff0fc6")

    $headers = @{
    'Authorization' = 'Bearer ' + $token.AccessToken
    'Content-Type' = 'application/json'
        'X-Requested-With'= 'XMLHttpRequest'
        'x-ms-client-request-id'= [guid]::NewGuid()
        'x-ms-correlation-id' = [guid]::NewGuid()
    }

    Invoke-RestMethod -Body $content -Header $headers -Method POST -Uri "https://main.iam.ad.ext.azure.com/api/Reports/SignInEventsV3"
}

$report = $()

Get-AzADUser | foreach {
    $events = Get-SignInEvents $_.Id
    $report += $events.Items
}

$report | Where-Object {$_.mfaRequired -eq $false} | Select-Object userPrincipalName, userDisplayName, createdDateTime, resourceDisplayName, loginSucceeded, failureReason, mfaRequired, mfaAuthMethod, mfaAuthDetail, mfaResult, @{Name='policies'; Expression={[string]::join(',', $($_.conditionalAccessPolicies | Select-Object displayName).displayName )}}, conditionalAccessStatus | Export-Csv report.csv
```

После запуска приведенного выше сценария сведения будут доступны в файле report.csv. Он будет содержать список попыток проверки подлинности, которые произошли за последний день, когда для пользователя не отображался запрос на выполнение MFA. Вам нужно будет просмотреть каждую запись, определив, является ли такое поведение ожидаемым, и в случае необходимости выполнить надлежащие действия.

![Отчет об оценке](images/security/assessment-report.png)

## <a name="common-issues"></a>Распространенные проблемы

### <a name="azure-active-directory"></a>Azure Active Directory

#### <a name="aadsts50076"></a>AADSTS50076

После включения базовых политик вы можете обнаружить, что при автоматизации или интеграции возникает исключение, подобное приведенному ниже.

    AADSTS50076: Due to a configuration change made by your administrator, or because you moved to a new location, you must use multi-factor authentication to access 'MyApp'.

Причина появления этого исключения заключается в выполнении проверки подлинности с использованием учетных данных пользователя. В таком случает требуется выполнение MFA. Чтобы устранить это исключение, вам нужно будет использовать маркер доступа для проверки подлинности. Дополнительные сведения см. в [этом руководстве](http://assetsprod.microsoft.com/secure-application-model-guide.pdf).

>[!IMPORTANT]
>Большинство современных API и модулей PowerShell поддерживают возможность использования маркера доступа для проверки подлинности. Однако существуют и те, которые в настоящее время не поддерживают эту функцию. Если вам нужна помощь, чтобы определить, поддерживает ли используемый API или модуль PowerShell применение маркера доступа для проверки подлинности, опубликуйте соответствующий вопрос в сообществе [Консультативная группа по обеспечению безопасности в Центре партнеров](https://www.microsoftpartnercommunity.com/t5/Partner-Center-Security-Guidance/ct-p/partner-center-security-guidance).

#### <a name="aadsts700082"></a>AADSTS700082

После реализации платформы модели безопасных приложений есть вероятность, что следующее исключение появится через 90 дней после создания начального маркера обновления.

    The refresh token has expired due to inactivity. The token was issued on 2019-01-02T09:19:53.5422744Z and was inactive for 90.00:00:00

Что касается Azure Active Directory, максимальный срок действия маркера обновления составляет 90 дней. Чтобы устранить эту ошибку, создайте маркер обновления и обеспечьте для него надежное хранение. Обратите внимание, что обновлять маркер обновления можно программным способом, так как при каждом запросе Azure Active Directory для маркера доступа возвращается новый маркер обновления. Вы можете реализовать соответствующую логику для обновления надежно сохраненного маркера обновления до истечения его срока действия.

Дополнительные сведения см. в статье [Configurable token lifetimes in Azure Active Directory (Preview)](https://docs.microsoft.com/azure/active-directory/develop/active-directory-configurable-token-lifetimes) (Настраиваемые сроки действия маркеров в Azure Active Directory (предварительная версия)).

### <a name="recovering-compromised-accounts"></a>Восстановление скомпрометированных учетных записей

Чтобы защитить наших клиентов, служба отслеживания утечки учетных данных Майкрософт находит общедоступные пары "имя пользователя — пароль". Если они соответствуют данным одного из наших пользователей, мы незамедлительно помогаем защитить эту учетную запись. Пользователи, имеющие утечку учетных данных, являются скомпрометированными. Вход в систему для этих пользователей будет заблокирован до тех пор, пока их пароль не будет сброшен.

Пользователи, которым назначена лицензия Azure AD Premium, могут восстановить доступ с помощью самостоятельного сброса пароля (SSPR), если эта возможность включена в их каталоге. Заблокированные пользователи без лицензии "Премиум" должны связаться с администратором, чтобы выполнить сброс пароля вручную и отклонить событие риска отмеченного пользователя.

#### <a name="steps-to-unblock-a-user"></a>Шаги для разблокировки пользователя

Изучив журналы входа пользователя, убедитесь, что пользователь был заблокирован политикой.

1. Администратор должен войти на **портал Azure** и выбрать **Azure Active Directory** > **Пользователи**, затем щелкнуть имя пользователя и перейти к разделу "События входа".
2. Чтобы инициировать сброс пароля для заблокированного пользователя, администратору необходимо выбрать **Azure Active Directory** > **Пользователи, находящиеся в группе риска**
3. Щелкните имя пользователя, учетная запись которого заблокирована, чтобы просмотреть сведения о последних действиях входа.
4. Щелкните "Сбросить пароль", чтобы назначить временный пароль, который необходимо будет изменить при следующем входе в систему.
5. Щелкните "Отклонить все события", чтобы сбросить оценку риска пользователя.

Теперь пользователь сможет войти в систему, сбросить свой пароль и получить доступ к приложению.

## <a name="known-issues"></a>Известные проблемы

### <a name="exchange-online-powershell"></a>Exchange Online PowerShell

Если MFA применяется принудительно, партнеры не могут использовать свои делегированные права администратора в службе Exchange Online PowerShell для выполнения действий с клиентами. Дополнительные сведения об этом ограничении см. в статье [Connect to Exchange Online PowerShell using multi-factor authentication](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/mfa-connect-to-exchange-online-powershell) (Подключение к Exchange Online PowerShell с помощью многофакторной проверки подлинности).

Чтобы обойти это ограничение, создайте учетную запись и никогда не используйте ее для интерактивной проверки подлинности. Для создания этой учетной записи и первоначальной настройки рекомендуем использовать [Azure AD PowerShell](https://docs.microsoft.com/powershell/module/azuread/). Вы можете использовать приведенный ниже сценарий PowerShell:

```powershell
Import-Module AzureAD
Connect-AzureAD

$PasswordProfile = New-Object -TypeName Microsoft.Open.AzureAD.Model.PasswordProfile

$PasswordProfile.Password = "Password"
$PasswordProfile.ForceChangePasswordNextLogin = $false

$user = New-AzureADUser -DisplayName "New User" -PasswordProfile $PasswordProfile -UserPrincipalName "NewUser@contoso.com" -AccountEnabled $true

# Uncomment the following two lines if you want the account to have Admin Agent privileges
# $adminAgentsGroup = Get-AzureADGroup -Filter "DisplayName eq 'AdminAgents'"
# Add-AzureADGroupMember -ObjectId $adminAgentsGroup.ObjectId -RefObjectId $user.ObjectId
```

При следующем подключении к Exchange Online через PowerShell используйте эту учетную запись — она будет работать должным образом.

> [!IMPORTANT]
> В дальнейшем партнеры смогут использовать свои делегированные права администратора в службе Exchange Online PowerShell для выполнения действий с клиентами, даже если будет применена проверка подлинности MFA. А пока вы можете использовать этот обходной метод.

## <a name="resources-and-support"></a>Ресурсы и поддержка

В сообществе [Консультативная группа по обеспечению безопасности в Центре партнеров](https://www.microsoftpartnercommunity.com/t5/Partner-Center-Security-Guidance/ct-p/partner-center-security-guidance) вы можете найти дополнительные ресурсы и сведения о предстоящих событиях, таких как рабочие часы технического отдела. Дополнительные сведения о требованиях см. в статье [Frequently asked questions about the partner security requirements](partner-security-requirements-faq.md) (Часто задаваемые вопросы о требованиях к безопасности для партнеров).
